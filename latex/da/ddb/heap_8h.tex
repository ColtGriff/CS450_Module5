\hypertarget{heap_8h}{}\doxysection{include/mem/heap.h File Reference}
\label{heap_8h}\index{include/mem/heap.h@{include/mem/heap.h}}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structheader}{header}}
\item 
struct \mbox{\hyperlink{structfooter}{footer}}
\item 
struct \mbox{\hyperlink{structindex__entry}{index\+\_\+entry}}
\item 
struct \mbox{\hyperlink{structindex__table}{index\+\_\+table}}
\item 
struct \mbox{\hyperlink{structheap}{heap}}
\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{heap_8h_a032503e76d6f69bc67e99e909c8125da}{T\+A\+B\+L\+E\+\_\+\+S\+I\+ZE}}~0x1000
\item 
\#define \mbox{\hyperlink{heap_8h_a15073b9742f7e29d8174509197eb4ab9}{K\+H\+E\+A\+P\+\_\+\+B\+A\+SE}}~0x\+D000000
\item 
\#define \mbox{\hyperlink{heap_8h_aee52619f74498ad224eb8e4354b89e40}{K\+H\+E\+A\+P\+\_\+\+M\+IN}}~0x10000
\item 
\#define \mbox{\hyperlink{heap_8h_a0f2696767a10e6efffc64e9b459c4ea6}{K\+H\+E\+A\+P\+\_\+\+S\+I\+ZE}}~0x1000000
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{heap_8h_a9bfb8053c2382598ef5b2175f475d49a}{\+\_\+kmalloc}} (\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} size, int align, \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} $\ast$phys\+\_\+addr)
\item 
\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{heap_8h_a15d6a52c5c080c8c7ffc73e336d8e574}{kmalloc}} (\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} size)
\item 
\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{heap_8h_aa2a6fb2aa05727dc1e7d72cbc108e63c}{kfree}} ()
\item 
void \mbox{\hyperlink{heap_8h_a755a69ff831b6e23a808dcf4b9944854}{init\+\_\+kheap}} ()
\item 
\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{heap_8h_a2b1d5a9ba11695605f74fc10cd719af5}{alloc}} (\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} size, \mbox{\hyperlink{structheap}{heap}} $\ast$hp, int align)
\item 
\mbox{\hyperlink{structheap}{heap}} $\ast$ \mbox{\hyperlink{heap_8h_a686135c02695aef4208f93d4549a15d0}{make\+\_\+heap}} (\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{tables_8h_ab5763c2b18c825c8b8fba44b2e60ddc1}{base}}, \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} max, \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} min)
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{heap_8h_a15073b9742f7e29d8174509197eb4ab9}\label{heap_8h_a15073b9742f7e29d8174509197eb4ab9}} 
\index{heap.h@{heap.h}!KHEAP\_BASE@{KHEAP\_BASE}}
\index{KHEAP\_BASE@{KHEAP\_BASE}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{KHEAP\_BASE}{KHEAP\_BASE}}
{\footnotesize\ttfamily \#define K\+H\+E\+A\+P\+\_\+\+B\+A\+SE~0x\+D000000}



Definition at line 6 of file heap.\+h.

\mbox{\Hypertarget{heap_8h_aee52619f74498ad224eb8e4354b89e40}\label{heap_8h_aee52619f74498ad224eb8e4354b89e40}} 
\index{heap.h@{heap.h}!KHEAP\_MIN@{KHEAP\_MIN}}
\index{KHEAP\_MIN@{KHEAP\_MIN}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{KHEAP\_MIN}{KHEAP\_MIN}}
{\footnotesize\ttfamily \#define K\+H\+E\+A\+P\+\_\+\+M\+IN~0x10000}



Definition at line 7 of file heap.\+h.

\mbox{\Hypertarget{heap_8h_a0f2696767a10e6efffc64e9b459c4ea6}\label{heap_8h_a0f2696767a10e6efffc64e9b459c4ea6}} 
\index{heap.h@{heap.h}!KHEAP\_SIZE@{KHEAP\_SIZE}}
\index{KHEAP\_SIZE@{KHEAP\_SIZE}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{KHEAP\_SIZE}{KHEAP\_SIZE}}
{\footnotesize\ttfamily \#define K\+H\+E\+A\+P\+\_\+\+S\+I\+ZE~0x1000000}



Definition at line 8 of file heap.\+h.

\mbox{\Hypertarget{heap_8h_a032503e76d6f69bc67e99e909c8125da}\label{heap_8h_a032503e76d6f69bc67e99e909c8125da}} 
\index{heap.h@{heap.h}!TABLE\_SIZE@{TABLE\_SIZE}}
\index{TABLE\_SIZE@{TABLE\_SIZE}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{TABLE\_SIZE}{TABLE\_SIZE}}
{\footnotesize\ttfamily \#define T\+A\+B\+L\+E\+\_\+\+S\+I\+ZE~0x1000}



Definition at line 5 of file heap.\+h.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{heap_8h_a9bfb8053c2382598ef5b2175f475d49a}\label{heap_8h_a9bfb8053c2382598ef5b2175f475d49a}} 
\index{heap.h@{heap.h}!\_kmalloc@{\_kmalloc}}
\index{\_kmalloc@{\_kmalloc}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{\_kmalloc()}{\_kmalloc()}}
{\footnotesize\ttfamily \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \+\_\+kmalloc (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}}}]{size,  }\item[{int}]{align,  }\item[{\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} $\ast$}]{phys\+\_\+addr }\end{DoxyParamCaption})}



Definition at line 24 of file heap.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{25 \{}
\DoxyCodeLine{26   \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} *addr;}
\DoxyCodeLine{27 }
\DoxyCodeLine{28   \textcolor{comment}{// Allocate on the kernel heap if one has been created}}
\DoxyCodeLine{29   \textcolor{keywordflow}{if} (\mbox{\hyperlink{heap_8c_a61825456a33b09780a5493c95adcae8a}{kheap}} != 0)\{}
\DoxyCodeLine{30     addr = (\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}}*)\mbox{\hyperlink{heap_8c_a06dae34c7e7c73d518de00212a7c92da}{alloc}}(size, \mbox{\hyperlink{heap_8c_a61825456a33b09780a5493c95adcae8a}{kheap}}, page\_align);}
\DoxyCodeLine{31     \textcolor{keywordflow}{if} (phys\_addr)\{}
\DoxyCodeLine{32       \mbox{\hyperlink{structpage__entry}{page\_entry}} *page = \mbox{\hyperlink{paging_8h_a69b165b3d1adf3aeaae126ca7a5aac3e}{get\_page}}((\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}})addr, \mbox{\hyperlink{heap_8c_a61ce943ba80d9dfab89a826cae9ddc4a}{kdir}}, 0);}
\DoxyCodeLine{33       *phys\_addr = (page-\/>\mbox{\hyperlink{structpage__entry_a68a6dc54a7ab6f7fb1a068476190bf67}{frameaddr}}*0x1000) + ((\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}})addr \& 0xFFF);}
\DoxyCodeLine{34     \}}
\DoxyCodeLine{35     \textcolor{keywordflow}{return} (\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}})addr;}
\DoxyCodeLine{36   \}}
\DoxyCodeLine{37   \textcolor{comment}{// Else, allocate directly from physical memory}}
\DoxyCodeLine{38   \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{39     \textcolor{keywordflow}{if} (page\_align \&\& (\mbox{\hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr}} \& 0xFFFFF000))\{}
\DoxyCodeLine{40       \mbox{\hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr}} \&= 0xFFFFF000;}
\DoxyCodeLine{41       \mbox{\hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr}} += 0x1000;}
\DoxyCodeLine{42     \}}
\DoxyCodeLine{43     addr = (\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}}*)\mbox{\hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr}};}
\DoxyCodeLine{44     \textcolor{keywordflow}{if} (phys\_addr)\{}
\DoxyCodeLine{45       *phys\_addr = \mbox{\hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr}};}
\DoxyCodeLine{46     \}}
\DoxyCodeLine{47     \mbox{\hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr}} += size;}
\DoxyCodeLine{48     \textcolor{keywordflow}{return} (\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}})addr;}
\DoxyCodeLine{49   \}}
\DoxyCodeLine{50 \}}

\end{DoxyCode}
\mbox{\Hypertarget{heap_8h_a2b1d5a9ba11695605f74fc10cd719af5}\label{heap_8h_a2b1d5a9ba11695605f74fc10cd719af5}} 
\index{heap.h@{heap.h}!alloc@{alloc}}
\index{alloc@{alloc}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{alloc()}{alloc()}}
{\footnotesize\ttfamily \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} alloc (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}}}]{size,  }\item[{\mbox{\hyperlink{structheap}{heap}} $\ast$}]{hp,  }\item[{int}]{align }\end{DoxyParamCaption})}



Definition at line 57 of file heap.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{58 \{}
\DoxyCodeLine{59   \mbox{\hyperlink{system_8h_ab3bb695e7817363c7bdb781f214e83a2}{no\_warn}}(size||align||h);}
\DoxyCodeLine{60   \textcolor{keyword}{static} \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} heap\_addr = \mbox{\hyperlink{heap_8h_a15073b9742f7e29d8174509197eb4ab9}{KHEAP\_BASE}};}
\DoxyCodeLine{61 }
\DoxyCodeLine{62   \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} \mbox{\hyperlink{tables_8h_ab5763c2b18c825c8b8fba44b2e60ddc1}{base}} = heap\_addr;}
\DoxyCodeLine{63   heap\_addr += size;}
\DoxyCodeLine{64 }
\DoxyCodeLine{65   \textcolor{keywordflow}{if} (heap\_addr > \mbox{\hyperlink{heap_8h_a15073b9742f7e29d8174509197eb4ab9}{KHEAP\_BASE}} + \mbox{\hyperlink{heap_8h_aee52619f74498ad224eb8e4354b89e40}{KHEAP\_MIN}})}
\DoxyCodeLine{66     \mbox{\hyperlink{serial_8h_a3514f7abff236a4e00a6c46021ce5e22}{serial\_println}}(\textcolor{stringliteral}{"{}Heap is full!"{}});}
\DoxyCodeLine{67 }
\DoxyCodeLine{68   \textcolor{keywordflow}{return} \mbox{\hyperlink{tables_8h_ab5763c2b18c825c8b8fba44b2e60ddc1}{base}};}
\DoxyCodeLine{69 \}}

\end{DoxyCode}
\mbox{\Hypertarget{heap_8h_a755a69ff831b6e23a808dcf4b9944854}\label{heap_8h_a755a69ff831b6e23a808dcf4b9944854}} 
\index{heap.h@{heap.h}!init\_kheap@{init\_kheap}}
\index{init\_kheap@{init\_kheap}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{init\_kheap()}{init\_kheap()}}
{\footnotesize\ttfamily void init\+\_\+kheap (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\mbox{\Hypertarget{heap_8h_aa2a6fb2aa05727dc1e7d72cbc108e63c}\label{heap_8h_aa2a6fb2aa05727dc1e7d72cbc108e63c}} 
\index{heap.h@{heap.h}!kfree@{kfree}}
\index{kfree@{kfree}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{kfree()}{kfree()}}
{\footnotesize\ttfamily \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} kfree (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\mbox{\Hypertarget{heap_8h_a15d6a52c5c080c8c7ffc73e336d8e574}\label{heap_8h_a15d6a52c5c080c8c7ffc73e336d8e574}} 
\index{heap.h@{heap.h}!kmalloc@{kmalloc}}
\index{kmalloc@{kmalloc}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{kmalloc()}{kmalloc()}}
{\footnotesize\ttfamily \mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}} kmalloc (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}}}]{size }\end{DoxyParamCaption})}



Definition at line 52 of file heap.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{53 \{}
\DoxyCodeLine{54   \textcolor{keywordflow}{return} \mbox{\hyperlink{heap_8c_a014b54e36b61f133f53dd509c461f35e}{\_kmalloc}}(size,0,0);}
\DoxyCodeLine{55 \}}

\end{DoxyCode}
\mbox{\Hypertarget{heap_8h_a686135c02695aef4208f93d4549a15d0}\label{heap_8h_a686135c02695aef4208f93d4549a15d0}} 
\index{heap.h@{heap.h}!make\_heap@{make\_heap}}
\index{make\_heap@{make\_heap}!heap.h@{heap.h}}
\doxysubsubsection{\texorpdfstring{make\_heap()}{make\_heap()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structheap}{heap}}$\ast$ make\+\_\+heap (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}}}]{base,  }\item[{\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}}}]{max,  }\item[{\mbox{\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}}}]{min }\end{DoxyParamCaption})}



Definition at line 71 of file heap.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{72 \{  }
\DoxyCodeLine{73   \mbox{\hyperlink{system_8h_ab3bb695e7817363c7bdb781f214e83a2}{no\_warn}}(\mbox{\hyperlink{tables_8h_ab5763c2b18c825c8b8fba44b2e60ddc1}{base}}||max||min);}
\DoxyCodeLine{74   \textcolor{keywordflow}{return} (\mbox{\hyperlink{structheap}{heap}}*)\mbox{\hyperlink{heap_8c_a15d6a52c5c080c8c7ffc73e336d8e574}{kmalloc}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structheap}{heap}}));}
\DoxyCodeLine{75 \}}

\end{DoxyCode}
