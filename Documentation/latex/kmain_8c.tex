\hypertarget{kmain_8c}{}\doxysection{kernel/core/kmain.c File Reference}
\label{kmain_8c}\index{kernel/core/kmain.c@{kernel/core/kmain.c}}
{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$system.\+h$>$}\newline
{\ttfamily \#include $<$core/io.\+h$>$}\newline
{\ttfamily \#include $<$core/serial.\+h$>$}\newline
{\ttfamily \#include $<$core/tables.\+h$>$}\newline
{\ttfamily \#include $<$core/interrupts.\+h$>$}\newline
{\ttfamily \#include $<$mem/heap.\+h$>$}\newline
{\ttfamily \#include $<$mem/paging.\+h$>$}\newline
{\ttfamily \#include \char`\"{}modules/mpx\+\_\+supt.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}modules/\+R1/commhand.\+h\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{kmain_8c_a406c20548822065e144564476378f8a1}{kmain}} (void)
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{kmain_8c_a406c20548822065e144564476378f8a1}\label{kmain_8c_a406c20548822065e144564476378f8a1}} 
\index{kmain.c@{kmain.c}!kmain@{kmain}}
\index{kmain@{kmain}!kmain.c@{kmain.c}}
\doxysubsubsection{\texorpdfstring{kmain()}{kmain()}}
{\footnotesize\ttfamily void kmain (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line 28 of file kmain.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{29 \{}
\DoxyCodeLine{30    \textcolor{comment}{// extern uint32\_t magic;}}
\DoxyCodeLine{31    \textcolor{comment}{// Uncomment if you want to access the multiboot header}}
\DoxyCodeLine{32    \textcolor{comment}{// extern void *mbd;}}
\DoxyCodeLine{33    \textcolor{comment}{// char *boot\_loader\_name = (char*)((long*)mbd)[16];}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35   }
\DoxyCodeLine{36    \textcolor{comment}{// 0) Initialize Serial I/O }}
\DoxyCodeLine{37    \textcolor{comment}{// functions to initialize serial I/O can be found in serial.c}}
\DoxyCodeLine{38    \textcolor{comment}{// there are 3 functions to call}}
\DoxyCodeLine{39 }
\DoxyCodeLine{40    \mbox{\hyperlink{serial_8h_a7078c07ff8b2c48780558549a8f7cf90}{init\_serial}}(\mbox{\hyperlink{serial_8h_a00dbb3ab1c59e14699be9393693e2248}{COM1}});}
\DoxyCodeLine{41    \mbox{\hyperlink{serial_8h_a3f4008da5feabfb7e086f6673a81104b}{set\_serial\_in}}(\mbox{\hyperlink{serial_8h_a00dbb3ab1c59e14699be9393693e2248}{COM1}});}
\DoxyCodeLine{42    \mbox{\hyperlink{serial_8h_ae97b87ee1f57c687e7fca6f9958e03ef}{set\_serial\_out}}(\mbox{\hyperlink{serial_8h_a00dbb3ab1c59e14699be9393693e2248}{COM1}});}
\DoxyCodeLine{43    }
\DoxyCodeLine{44    \mbox{\hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}}(\textcolor{stringliteral}{"{}Starting MPX boot sequence..."{}});}
\DoxyCodeLine{45    \mbox{\hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}}(\textcolor{stringliteral}{"{}Initialized serial I/O on COM1 device..."{}});}
\DoxyCodeLine{46 }
\DoxyCodeLine{47    \textcolor{comment}{// 1) Initialize the support software by identifying the current}}
\DoxyCodeLine{48    \textcolor{comment}{//     MPX Module.  This will change with each module.}}
\DoxyCodeLine{49    \textcolor{comment}{// you will need to call mpx\_init from the mpx\_supt.c}}
\DoxyCodeLine{50 }
\DoxyCodeLine{51    \mbox{\hyperlink{mpx__supt_8c_a53332c6a3107a4feed6e2e79690a6ffa}{mpx\_init}}(\mbox{\hyperlink{mpx__supt_8h_a9d88621bfb79cb860b9ea2b5abb1c7f0}{MODULE\_R1}});}
\DoxyCodeLine{52    }
\DoxyCodeLine{53    \textcolor{comment}{// 2) Check that the boot was successful and correct when using grub}}
\DoxyCodeLine{54    \textcolor{comment}{// Comment this when booting the kernel directly using QEMU, etc.}}
\DoxyCodeLine{55    \textcolor{comment}{//if ( magic != 0x2BADB002 )\{}}
\DoxyCodeLine{56    \textcolor{comment}{//  kpanic("{}Boot was not error free. Halting."{});}}
\DoxyCodeLine{57    \textcolor{comment}{//\}}}
\DoxyCodeLine{58    }
\DoxyCodeLine{59    \textcolor{comment}{// 3) Descriptor Tables -\/-\/ tables.c}}
\DoxyCodeLine{60    \textcolor{comment}{//  you will need to initialize the global}}
\DoxyCodeLine{61    \textcolor{comment}{// this keeps track of allocated segments and pages}}
\DoxyCodeLine{62    \mbox{\hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}}(\textcolor{stringliteral}{"{}Initializing descriptor tables..."{}});}
\DoxyCodeLine{63 }
\DoxyCodeLine{64    \mbox{\hyperlink{tables_8h_a86bb50044169930202cc403376ef40c3}{init\_gdt}}();}
\DoxyCodeLine{65    \mbox{\hyperlink{tables_8h_a35fe413107af682030ab7a4b6dff19b8}{init\_idt}}();}
\DoxyCodeLine{66 }
\DoxyCodeLine{67    \mbox{\hyperlink{interrupts_8h_afbc0dbef6f15e2df21b38724ea38c483}{init\_pic}}();}
\DoxyCodeLine{68    \mbox{\hyperlink{system_8h_ac5d15f274bc9b1e96230f3d3c60fd1f8}{sti}}();}
\DoxyCodeLine{69    }
\DoxyCodeLine{70     \textcolor{comment}{// 4)  Interrupt vector table -\/-\/  tables.c}}
\DoxyCodeLine{71     \textcolor{comment}{// this creates and initializes a default interrupt vector table}}
\DoxyCodeLine{72     \textcolor{comment}{// this function is in tables.c}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74    \mbox{\hyperlink{interrupts_8h_ad17d9a8aa78440af8fc40d3fd55dbad8}{init\_irq}}();}
\DoxyCodeLine{75     }
\DoxyCodeLine{76     \mbox{\hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}}(\textcolor{stringliteral}{"{}Interrupt vector table initialized!"{}});}
\DoxyCodeLine{77     }
\DoxyCodeLine{78    \textcolor{comment}{// 5) Virtual Memory -\/-\/ paging.c  -\/-\/ init\_paging}}
\DoxyCodeLine{79    \textcolor{comment}{//  this function creates the kernel's heap}}
\DoxyCodeLine{80    \textcolor{comment}{//  from which memory will be allocated when the program calls}}
\DoxyCodeLine{81    \textcolor{comment}{// sys\_alloc\_mem UNTIL the memory management module  is completed}}
\DoxyCodeLine{82    \textcolor{comment}{// this allocates memory using discrete "{}pages"{} of physical memory}}
\DoxyCodeLine{83    \textcolor{comment}{// NOTE:  You will only have about 70000 bytes of dynamic memory}}
\DoxyCodeLine{84    \textcolor{comment}{//}}
\DoxyCodeLine{85    \mbox{\hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}}(\textcolor{stringliteral}{"{}Initializing virtual memory..."{}});}
\DoxyCodeLine{86 }
\DoxyCodeLine{87    \mbox{\hyperlink{paging_8h_a919b727f386797a8b9d8eceb5c4e7313}{init\_paging}}();}
\DoxyCodeLine{88 }
\DoxyCodeLine{89    \textcolor{comment}{// 6) Call YOUR command handler -\/  interface method}}
\DoxyCodeLine{90    \mbox{\hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}}(\textcolor{stringliteral}{"{}Transferring control to commhand..."{}});}
\DoxyCodeLine{91    \mbox{\hyperlink{commhand_8c_a14d85617242501c323a203ee196d3efa}{commhand}}();}
\DoxyCodeLine{92 }
\DoxyCodeLine{93    \textcolor{comment}{// 7) System Shutdown on return from your command handler}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95    \mbox{\hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}}(\textcolor{stringliteral}{"{}Starting system shutdown procedure..."{}});}
\DoxyCodeLine{96    }
\DoxyCodeLine{97    \textcolor{comment}{/* Shutdown Procedure */}}
\DoxyCodeLine{98    \mbox{\hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}}(\textcolor{stringliteral}{"{}Shutdown complete. You may now turn off the machine. (QEMU: C-\/a x)"{}});}
\DoxyCodeLine{99    \mbox{\hyperlink{system_8h_a954b0134ce21d80f0efb22c77e821da3}{hlt}}();}
\DoxyCodeLine{100 \}}

\end{DoxyCode}
